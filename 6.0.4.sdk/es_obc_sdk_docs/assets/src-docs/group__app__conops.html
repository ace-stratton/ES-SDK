<!-- HTML header for doxygen 1.9.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="$langISO">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EnduroSat On-Board Computer SDK Documentation: conops</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
$darkmode
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><a href="../../index.html"><img alt="Logo" src="EnduroSat_horLogo_symbol@2x-min.png"/></a></td>
  <td id="projectalign">
   <div id="projectname">EnduroSat On-Board Computer SDK Documentation
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__app__conops.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#files">Files</a>  </div>
  <div class="headertitle"><div class="title">conops<div class="ingroups"><a class="el" href="group__app.html">Applications</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="files" name="files"></a>
Files</h2></td></tr>
<tr class="memitem:conops__cfg_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops__cfg_8h.html">conops_cfg.h</a></td></tr>
<tr class="memdesc:conops__cfg_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concept of operations configuration header. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:conops_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops_8c.html">conops.c</a></td></tr>
<tr class="memdesc:conops_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concept of Operations source file. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:conops_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops_8h.html">conops.h</a></td></tr>
<tr class="memdesc:conops_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concept of Operations header file. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:conops__payload_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops__payload_8c.html">conops_payload.c</a></td></tr>
<tr class="memdesc:conops__payload_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concept of operations payload source file. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:conops__payload_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops__payload_8h.html">conops_payload.h</a></td></tr>
<tr class="memdesc:conops__payload_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">Concept of operations payload related source file. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:conops__periodic__ev__task_8c"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops__periodic__ev__task_8c.html">conops_periodic_ev_task.c</a></td></tr>
<tr class="memdesc:conops__periodic__ev__task_8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Periodic Event Task for the ConOps SM. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:conops__periodic__ev__task_8h"><td class="memItemLeft" align="right" valign="top">file &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="conops__periodic__ev__task_8h.html">conops_periodic_ev_task.h</a></td></tr>
<tr class="memdesc:conops__periodic__ev__task_8h"><td class="mdescLeft">&#160;</td><td class="mdescRight">ConOps periodic events task header. <br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Concept of Operations (ConOps)</p>
<p >The ConOps is the logic, which controls the spececraft. It does this based on predefined logic, using inputs from the different subsystems and considering the user configurable values (detailed description can be found under <b>Development recipes/Operational Modes</b>). It also serves as the glue between the <b>Payload Controller</b> (check <a class="el" href="payload__ctrl_8h.html" title="Payload Controller public interface.">payload_ctrl.h</a>) and the <b>Payload Scheduler</b> (check <a class="el" href="payload__scheduler_8h.html" title="Basic payload scheduler service interface.">payload_scheduler.h</a>) offering great flexibility in the integration and operation of payloads.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Introduction</h2>
<p >The current ConOps is built around a Hierarchical State Machine (HSM) generated using the <a class="el" href="libhsm_8h.html" title="HSM engine library public interface.">libhsm.h</a> engine. It consists of several operational modes, namely:</p><ul>
<li>SAFE</li>
<li>DETUMBLING</li>
<li>IDLE</li>
<li>PAYLOAD MODES</li>
</ul>
<p >By default, the OBC starts in <b>SAFE</b> mode. At the start of this mode all payloads are turned off. The requested turn-off mode is immediate, i.e. no soft shutdown is envisioned, but this also depends on how the payload is integrated in the system. The other important thing which is triggered at the start of <b>SAFE</b> mode is the clearing of any internal flags that have been set up to this moment.</p>
<p >Mode transitions are triggered by two types of events (you can also check the <b>libhsm</b> documentation for more details):</p><ul>
<li>mode change requests - these are direct requests for a switch to a certain mode. The switch will happen only if the guard conditions are met.</li>
<li>periodic checks request - these are sent every 10 seconds. When such a request is made the HSM evaluates the guard conditions and checks if it needs to switch to a new mode.</li>
</ul>
<h3><a class="anchor" id="autotoc_md2"></a>
The ConOps Task</h3>
<p >The ConOps task runs every 10 seconds, has normal priority and is responsible for:</p><ul>
<li><span class="emoji">&#x2705;</span> Checking for updates in the user configurable values</li>
<li><span class="emoji">&#x2705;</span> Generating events for the periodic checks requests</li>
<li><span class="emoji">&#x2705;</span> Putting the satellite back in sun-tracking mode (STT)</li>
<li><span class="emoji">&#x274c;</span> Checking if a power-off of the OBC may be approaching</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The check for the power-off is not implemented!</dd></dl>
<h2><a class="anchor" id="autotoc_md3"></a>
What are the guard conditions?</h2>
<p >Changing from one mode to another is controlled via the guard conditions. There, several types of inputs are evaluated and checked before a <b>go/no-go</b> decision to change to a mode is made. Different inputs are listed below.</p>
<h3><a class="anchor" id="autotoc_md4"></a>
Physical Parameters and AOCS Flags</h3>
<ul>
<li><b>Battery capacity [mWh]</b> from <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___e_p_s__0__t.html">DATA_CACHE_EPS_0_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a></li>
<li><b>Norm of the angular velocity vector as measured in the satellite body-frame [mrad/s]</b> from <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a></li>
<li><b>The angular velocity vector as measured in the satellite body-frame [mrad/s]</b> from <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a></li>
<li><b>Estimated attitude angles in [mdeg]</b> from <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a></li>
<li><b>Measured wheel speed [RPM]</b> from <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a></li>
<li><b>AOCS specific error flags</b> from <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a>. The exact errors mask depends on the used AOCS subsystem.</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
The AOCS Commissioning Status</h3>
<p >The AOCS sub-system is used according to the level of its commissioning. Initially, until all components of the AOCS are checked the status is kept to 0 (no commissioning, check <a class="el" href="cubeadcs_8h.html" title="Public interface of the CubeADCS.">cubeadcs.h</a>) and most of the operational modes logic will not be triggered. Once the AOCS is commissioned, the full capabilities of the ConOps can be used (including the sun-tracking logic).</p>
<dl class="section note"><dt>Note</dt><dd>Currently, the commissioning status is hard-wired to the cubeadcs commissioning status.</dd></dl>
<h3><a class="anchor" id="autotoc_md6"></a>
The AOCS System State</h3>
<p >The AOCS system state is an aggregation of the estimation mode, control mode, enabled AOCS specific periphery, etc. Its purpose is to facilitate the control of the AOCS system. It resides in <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___s_y_s___s_t_a_t_e__t.html">DATA_CACHE_AOCS_CNTRL_SYS_STATE_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a>. Further information regarding the AOCS system state can be found in <a class="el" href="aocs__cntrl_8h.html" title="Attitude and Orbit Control System Interface.">aocs_cntrl.h</a></p>
<h2><a class="anchor" id="autotoc_md7"></a>
The ConOps Flags</h2>
<p >Several flags are used to also control the behaviour of the ConOps. The flags are set from within the ConOps or coupled SW modules. Once a set flag is read, its value is cleared without user intervention.</p>
<p >All flags can also be set through the <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___con_ops_flags__t.html">DATA_CACHE_ConOpsFlags_t</a></b> type from <a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a>. This is especially useful when performing testing.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Payload Error</h3>
<p >This logical flag is set by the activated payload. It will drop the ConOps from <b>PAYLOAD[x]</b> mode to <b>IDLE</b> mode. The actual error is not clear and it is up to the payload logic to record the error or report it on user request.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
ADCS Error</h3>
<p >This error flag is reported when an error in the AOCS system has been identified. This may be produced by an internal AOCS system error or by the <b>Payload Controller</b> when it attempts to put the AOCS system in a certain system state. If the error was produced by the AOCS system, it can be identified from the <b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b> type. However the exact meaning of the error will depend on the exact AOCS system.</p>
<h3><a class="anchor" id="autotoc_md10"></a>
Detumbling Completed</h3>
<p >This logical flag is set once detumbling or stable Y-Thomson control has been achieved. It is used to indicate that the <b>DETUMBLING</b> mode can be exited.</p>
<h2><a class="anchor" id="autotoc_md11"></a>
Testing and Debugging</h2>
<h3><a class="anchor" id="autotoc_md12"></a>
Testing</h3>
<p >The ConOps transitions and paylaod activation can be tested without any additional hardware. To this end the <b>Data Cache</b> (<a class="el" href="datacache_8h.html" title="Data Cache public header generator.">datacache.h</a>) types and relevant setters and getters are used.</p>
<dl class="section warning"><dt>Warning</dt><dd>By default each <b>Data Cache</b> type expires in 5 seconds!</dd></dl>
<p>The user can feed the following types periodically:</p><ul>
<li><b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___e_p_s__0__t.html">DATA_CACHE_EPS_0_t</a></b></li>
<li><b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___t_l_m__t.html">DATA_CACHE_AOCS_CNTRL_TLM_t</a></b></li>
</ul>
<p >and monitor:</p><ul>
<li><b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___a_o_c_s___c_n_t_r_l___s_y_s___s_t_a_t_e__t.html">DATA_CACHE_AOCS_CNTRL_SYS_STATE_t</a></b></li>
<li><b><a class="el" href="struct_d_a_t_a___c_a_c_h_e___con_ops_flags__t.html">DATA_CACHE_ConOpsFlags_t</a></b></li>
</ul>
<dl class="section warning"><dt>Warning</dt><dd>Setting a <b>Data Cache</b> type externally (via command) will inhibit OBC's ability to internally update this type! This behaviour is cleared after reset.</dd></dl>
<p>However, if more specific transitions need to be tested, the user can decide to modify all types and the commissioning status. The full list of transitions and their dependence on the input parameters can be found in the <b>Developer's Guide</b>.</p>
<h3><a class="anchor" id="autotoc_md13"></a>
Debugging</h3>
<p >The easiest way to debug the ConOps is to use the built-in tracing capabilities of the OBC. Currently, there are three types of tracing that need to be enabled to fully monitor the ConOps behaviour:</p><ul>
<li><b>DEBUG_TRACE_OP_MODES_ENABLED</b></li>
<li><b>DEBUG_TRACE_AOCS_CNTRL_ENABLED</b></li>
<li><b>DEBUG_TRACE_CUBEADCS_ENABLED</b></li>
</ul>
<p >An example debug log: <img src="../img/conops_trace_dbg.png" alt="Example debug log" class="inline"/></p>
<p >There are several headers used to describe specific parts of the ConOps:</p><ul>
<li><b>[GUARD_DBG]</b> indicates a guard condition evaluation is started/exited.</li>
<li><b>[TEST_COND]</b> indicates the actual test which is being executed, within the guard condition.</li>
<li><b>[STT_DBG]</b> informs on the sun-tracking transition logic status and execution.</li>
<li><b>[AOCS_CNTRL]</b> informs on the AOCS control execution. It is important for monitoring the AOCS system state changes.</li>
<li><b>[CUBEADCS]</b> informs on the CubeADCS state machine changes. Again, it is important when monitoring AOCS system state changes.</li>
</ul>
<p >Refer to the <b>Developer's Guide</b> to learn more about debugging and tracing.</p>
<h2><a class="anchor" id="autotoc_md14"></a>
Modifying the ConOps</h2>
<p >The provided ConOps can be extended or modified based on the user needs. Care must be taken to thoroughly test all transition if a modification is made. </p>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.9.5-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by Doxygen 1.9.4 </li>
  </ul>
</div>
</body>
</html>
