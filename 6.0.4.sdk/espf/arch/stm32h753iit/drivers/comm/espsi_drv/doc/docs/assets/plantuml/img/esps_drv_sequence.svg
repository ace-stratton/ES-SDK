<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1421px" preserveAspectRatio="none" style="width:1231px;height:1421px;background:#FFFFFF;" version="1.1" viewBox="0 0 1231 1421" width="1231px" zoomAndPan="magnify"><defs><filter height="300%" id="f16tqpf0o4b60a" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><text fill="#000000" font-family="sans-serif" font-size="18" lengthAdjust="spacing" textLength="390" x="417" y="30.6855">Sequence for message transmition and reception</text><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="410" y="1026.7031"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="60.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="731" y="506.0781"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="121.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="313.9688"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="130.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="1127.7578"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="397.0547" style="stroke:#000000;stroke-width:2.0;" width="1106" x="53" y="945.6484"/><rect fill="#FFFFFF" height="15.8359" style="stroke:none;stroke-width:1.0;" width="1106" x="53" y="1326.8672"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="123" x2="123" y1="95.8594" y2="1359.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="414.5" x2="414.5" y1="95.8594" y2="1359.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="535.5" x2="535.5" y1="95.8594" y2="1359.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="735.5" x2="735.5" y1="95.8594" y2="1359.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="935" x2="935" y1="95.8594" y2="1359.7031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="1159" x2="1159" y1="95.8594" y2="1359.7031"/><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="116" x="63" y="59.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="70" y="80.7832">User Application</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="116" x="63" y="1358.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="70" y="1380.2363">User Application</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="89" x="368.5" y="59.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="375.5" y="80.7832">MAC Config</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="89" x="368.5" y="1358.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="375.5" y="1380.2363">MAC Config</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="125" x="471.5" y="59.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="478.5" y="80.7832">Function Protocol</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="125" x="471.5" y="1358.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="111" x="478.5" y="1380.2363">Function Protocol</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="57" x="705.5" y="59.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="712.5" y="80.7832">ESPS I</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="57" x="705.5" y="1358.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="712.5" y="1380.2363">ESPS I</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="84" x="891" y="41.6406"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="909.5" y="63.1738">ESPS I</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="898" y="80.7832">MAC Layer</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="49.2188" style="stroke:#A80036;stroke-width:1.5;" width="84" x="891" y="1358.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="43" x="909.5" y="1380.2363">ESPS I</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="898" y="1397.8457">MAC Layer</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1128" y="55.25"/><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1124" y="59.25"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="1131" y="80.7832">ST HAL</text><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1128" y="1358.7031"/><rect fill="#FEFECE" filter="url(#f16tqpf0o4b60a)" height="31.6094" style="stroke:#A80036;stroke-width:1.5;" width="62" x="1124" y="1362.7031"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="48" x="1131" y="1384.2363">ST HAL</text><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="30.3516" style="stroke:#A80036;stroke-width:1.0;" width="10" x="410" y="1026.7031"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="60.7031" style="stroke:#A80036;stroke-width:1.0;" width="10" x="731" y="506.0781"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="121.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="313.9688"/><rect fill="#FFFFFF" filter="url(#f16tqpf0o4b60a)" height="130.4063" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="1127.7578"/><rect fill="#EEEEEE" filter="url(#f16tqpf0o4b60a)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1224" x="0" y="127.0352"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1224" y1="127.0352" y2="127.0352"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1224" y1="130.0352" y2="130.0352"/><rect fill="#EEEEEE" filter="url(#f16tqpf0o4b60a)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="97" x="563.5" y="115.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="79" x="569.5" y="133.3545">initialization</text><path d="M1098,155.2109 L1098,181.2109 L1215,181.2109 L1215,165.2109 L1205,155.2109 L1098,155.2109 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1205,155.2109 L1205,165.2109 L1215,165.2109 L1205,155.2109 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="1104" y="173.7061">initialize ST HAL</text><polygon fill="#A80036" points="1147,208.9141,1157,212.9141,1147,216.9141,1151,212.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="1153" y1="212.9141" y2="212.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="57" x="130" y="208.0576">HAL_Init()</text><polygon fill="#A80036" points="1147,239.2656,1157,243.2656,1147,247.2656,1151,243.2656" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="1153" y1="243.2656" y2="243.2656"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="129" x="130" y="238.4092">SystemClock_Config()</text><path d="M852,256.2656 L852,282.2656 L1013,282.2656 L1013,266.2656 L1003,256.2656 L852,256.2656 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1003,256.2656 L1003,266.2656 L1013,266.2656 L1003,256.2656 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="140" x="858" y="274.7607">initialize MAC interfaces</text><polygon fill="#A80036" points="918,309.9688,928,313.9688,918,317.9688,922,313.9688" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="924" y1="313.9688" y2="313.9688"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="130" y="309.1123">MAC_bStartAllIfs()</text><polygon fill="#A80036" points="918,340.3203,928,344.3203,918,348.3203,922,344.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="415" x2="924" y1="344.3203" y2="344.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="283" x="422" y="339.4639">UART Configuration Definitions: fs_asMACStates</text><polygon fill="#A80036" points="918,370.6719,928,374.6719,918,378.6719,922,374.6719" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="415" x2="924" y1="374.6719" y2="374.6719"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="339" x="422" y="369.8154">Timers Configuration Definitions: TIM_CFG_asTimerEntries</text><polygon fill="#A80036" points="1147,401.0234,1157,405.0234,1147,409.0234,1151,405.0234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="1153" y1="405.0234" y2="405.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="947" y="400.167">MAC_RNG_Init()</text><polygon fill="#A80036" points="1147,431.375,1157,435.375,1147,439.375,1151,435.375" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="935" x2="1153" y1="435.375" y2="435.375"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="96" x="942" y="430.5186">MAC_TIM_bInit()</text><path d="M606,448.375 L606,474.375 L861,474.375 L861,458.375 L851,448.375 L606,448.375 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M851,448.375 L851,458.375 L861,458.375 L851,448.375 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234" x="612" y="466.8701">initialize the stack and the FP Callbacks</text><polygon fill="#A80036" points="719,502.0781,729,506.0781,719,510.0781,723,506.0781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="725" y1="506.0781" y2="506.0781"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="130" y="501.2217">ESSA_Stack_Init()</text><polygon fill="#A80036" points="547,532.4297,537,536.4297,547,540.4297,543,536.4297" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="730" y1="536.4297" y2="536.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="168" x="553" y="531.5732">&lt;PROTOCOL&gt;ClientAppInit()</text><polygon fill="#A80036" points="547,562.7813,537,566.7813,547,570.7813,543,566.7813" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="541" x2="735" y1="566.7813" y2="566.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="553" y="561.9248">&lt;PROTOCOL&gt;ServerAppInit()</text><rect fill="#EEEEEE" filter="url(#f16tqpf0o4b60a)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1224" x="0" y="595.957"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1224" y1="595.957" y2="595.957"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1224" y1="598.957" y2="598.957"/><rect fill="#EEEEEE" filter="url(#f16tqpf0o4b60a)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="171" x="526.5" y="584.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="153" x="532.5" y="602.2764">transmition of messages</text><path d="M13,624.1328 L13,650.1328 L229,650.1328 L229,634.1328 L219,624.1328 L13,624.1328 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M219,624.1328 L219,634.1328 L229,634.1328 L219,624.1328 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="195" x="19" y="642.6279">Send a request of certain protocol</text><polygon fill="#A80036" points="524,677.8359,534,681.8359,524,685.8359,528,681.8359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="530" y1="681.8359" y2="681.8359"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="209" x="130" y="676.9795">&lt;PROTOCOL&gt;_&lt;COMMAND&gt;Req()</text><polygon fill="#A80036" points="724,708.1875,734,712.1875,724,716.1875,728,712.1875" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="536" x2="730" y1="712.1875" y2="712.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="175" x="543" y="707.3311">ESSA_Stack_SendFrameEx()</text><polygon fill="#A80036" points="923,738.5391,933,742.5391,923,746.5391,927,742.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="736" x2="929" y1="742.5391" y2="742.5391"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138" x="743" y="737.6826">MAC_DrvEnqMessage()</text><path d="M940,755.5391 L940,814.5391 L1149,814.5391 L1149,765.5391 L1139,755.5391 L940,755.5391 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1139,755.5391 L1139,765.5391 L1149,765.5391 L1139,755.5391 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="946" y="774.0342">The driver will send the message</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="950" y="790.3857">taking in account its priority</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="107" x="950" y="806.7373">and the bus traffic.</text><polygon fill="#A80036" points="134,841.9453,124,845.9453,134,849.9453,130,845.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="128" x2="934" y1="845.9453" y2="845.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="140" y="841.0889">ESSATMAC_EC_OK</text><rect fill="#EEEEEE" filter="url(#f16tqpf0o4b60a)" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="1224" x="0" y="875.1211"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1224" y1="875.1211" y2="875.1211"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="1224" y1="878.1211" y2="878.1211"/><rect fill="#EEEEEE" filter="url(#f16tqpf0o4b60a)" height="24.3516" style="stroke:#000000;stroke-width:2.0;" width="160" x="532" y="863.9453"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="142" x="538" y="881.4404">reception of messages</text><path d="M5,903.2969 L5,929.2969 L237,929.2969 L237,913.2969 L227,903.2969 L5,903.2969 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M227,903.2969 L227,913.2969 L237,913.2969 L227,903.2969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="11" y="921.792">Loop to dispatch received messages</text><path d="M53,945.6484 L118,945.6484 L118,953.6484 L108,963.6484 L53,963.6484 L53,945.6484 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="397.0547" style="stroke:#000000;stroke-width:2.0;" width="1106" x="53" y="945.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="20" x="68" y="960.1436">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="236" x="133" y="959.0674">[if MAC_bMessageInQueue(&lt;interface ID&gt;)]</text><path d="M128,969 L128,995 L390,995 L390,979 L380,969 L128,969 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M380,969 L380,979 L390,979 L380,969 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241" x="134" y="987.4951">Get the interface instance from the drivers</text><polygon fill="#A80036" points="398,1022.7031,408,1026.7031,398,1030.7031,402,1026.7031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="404" y1="1026.7031" y2="1026.7031"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="268" x="130" y="1021.8467">MacCfg_sGetMacInterfaceById(&lt;interface ID&gt;)</text><polygon fill="#A80036" points="134,1053.0547,124,1057.0547,134,1061.0547,130,1057.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="128" x2="414" y1="1057.0547" y2="1057.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="49" x="140" y="1052.1982">interface</text><path d="M128,1070.0547 L128,1096.0547 L469,1096.0547 L469,1080.0547 L459,1070.0547 L128,1070.0547 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M459,1070.0547 L459,1080.0547 L469,1080.0547 L459,1070.0547 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="320" x="134" y="1088.5498">Dispatch, if any, the messages received in the interface</text><polygon fill="#A80036" points="918,1123.7578,928,1127.7578,918,1131.7578,922,1127.7578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="123" x2="924" y1="1127.7578" y2="1127.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="262" x="130" y="1122.9014">MAC_DISP_vDispatchMessages(&lt;interface&gt;)</text><path d="M945,1140.7578 L945,1182.7578 L1116,1182.7578 L1116,1150.7578 L1106,1140.7578 L945,1140.7578 " fill="#FBFB77" filter="url(#f16tqpf0o4b60a)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M1106,1140.7578 L1106,1150.7578 L1116,1150.7578 L1106,1140.7578 " fill="#FBFB77" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="951" y="1159.2529">Verify that the MAC frame</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="146" x="955" y="1175.6045">contains a valid message</text><line style="stroke:#A80036;stroke-width:1.0;" x1="940" x2="982" y1="1214.8125" y2="1214.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="982" x2="982" y1="1214.8125" y2="1227.8125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="941" x2="982" y1="1227.8125" y2="1227.8125"/><polygon fill="#A80036" points="951,1223.8125,941,1227.8125,951,1231.8125,947,1227.8125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200" x="947" y="1209.9561">MAC_bProtocolProcessMessage()</text><polygon fill="#A80036" points="747,1254.1641,737,1258.1641,747,1262.1641,743,1258.1641" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="741" x2="934" y1="1258.1641" y2="1258.1641"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170" x="753" y="1253.3076">ESSA_Stack_DataDispatch()</text><polygon fill="#A80036" points="547,1284.5156,537,1288.5156,547,1292.5156,543,1288.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="541" x2="735" y1="1288.5156" y2="1288.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="553" y="1283.6592">fs_HandleData()</text><polygon fill="#A80036" points="134,1314.8672,124,1318.8672,134,1322.8672,130,1318.8672" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="128" x2="535" y1="1318.8672" y2="1318.8672"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="302" x="140" y="1314.0107">&lt;PROTOCOL&gt;_&lt;COMMAND&gt;RequestHandlerImpl()</text><line style="stroke:#000000;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="53" x2="1159" y1="1327.8672" y2="1327.8672"/><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="113" x="58" y="1339.2861">[nothing to process]</text><!--MD5=[591f088044ebb464afdbd88c3781a2f9]
@startuml

title Sequence for message transmition and reception

participant APP as "User Application"
participant CFG as "MAC Config"
participant FP  as "Function Protocol"
participant ESS as "ESPS I"
participant MAC as "ESPS I \nMAC Layer"
collections HAL as "ST HAL"

== initialization ==
note over HAL: initialize ST HAL
APP -> HAL: HAL_Init()
APP -> HAL: SystemClock_Config()

note over MAC: initialize MAC interfaces
APP -> MAC: MAC_bStartAllIfs()
activate MAC
CFG - -> MAC: UART Configuration Definitions: fs_asMACStates
CFG - -> MAC: Timers Configuration Definitions: TIM_CFG_asTimerEntries
MAC -> HAL: MAC_RNG_Init()
MAC -> HAL: MAC_TIM_bInit()
deactivate MAC

note over ESS: initialize the stack and the FP Callbacks
APP -> ESS: ESSA_Stack_Init()
activate ESS
ESS -> FP: <PROTOCOL>ClientAppInit()
ESS -> FP: <PROTOCOL>ServerAppInit()
deactivate ESS

== transmition of messages ==

note over APP: Send a request of certain protocol
APP -> FP: <PROTOCOL>_<COMMAND>Req()
FP -> ESS: ESSA_Stack_SendFrameEx()
ESS -> MAC: MAC_DrvEnqMessage()
note right MAC: The driver will send the message\n taking in account its priority\n and the bus traffic.
MAC- ->APP: ESSATMAC_EC_OK

== reception of messages ==

note over APP: Loop to dispatch received messages
opt if MAC_bMessageInQueue(<interface ID>)
    note right APP: Get the interface instance from the drivers
    APP -> CFG: MacCfg_sGetMacInterfaceById(<interface ID>)
    activate CFG
    CFG - -> APP: interface
    deactivate CFG
    note right APP: Dispatch, if any, the messages received in the interface
    APP -> MAC: MAC_DISP_vDispatchMessages(<interface>)
    activate MAC
    note right MAC: Verify that the MAC frame\n contains a valid message
    MAC -> MAC: MAC_bProtocolProcessMessage()
    MAC - -> ESS: ESSA_Stack_DataDispatch()
    deactivate MAC
    ESS - -> FP: fs_HandleData()
    FP - -> APP: <PROTOCOL>_<COMMAND>RequestHandlerImpl()
else nothing to process
end opt

@enduml

PlantUML version 1.2021.12(Tue Oct 05 19:01:58 EEST 2021)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: GB
--></g></svg>